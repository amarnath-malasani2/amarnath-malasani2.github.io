<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
    <title>Card Details - Taaza</title>
    <link href="https://fonts.googleapis.com" rel="preconnect" />
    <link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect" />
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;700&amp;display=swap"
        rel="stylesheet" />
    <script src="https://cdn.tailwindcss.com?plugins=forms"></script>
    <script>
        tailwind.config = {
            darkMode: "class",
            theme: {
                extend: {
                    colors: {
                        "primary": "#FFD700",
                        "background-light": "#FFFFFF",
                        "background-dark": "#0C2D57",
                    },
                    fontFamily: {
                        "display": ["Space Grotesk", "sans-serif"]
                    },
                    borderRadius: {
                        "DEFAULT": "0.5rem",
                        "lg": "0.75rem",
                        "xl": "1rem",
                        "full": "9999px"
                    },
                },
            },
        }
    </script>
    <style>
        .material-symbols-outlined {
            font-variation-settings: 'FILL' 0, 'wght' 400, 'GRAD' 0, 'opsz' 24;
        }

        .card-input {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        .card-preview {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            transform-style: preserve-3d;
            transition: transform 0.6s;
        }

        .card-preview.flipped {
            transform: rotateY(180deg);
        }

        .card-front,
        .card-back {
            backface-visibility: hidden;
            position: absolute;
            width: 100%;
            height: 100%;
        }

        .card-back {
            transform: rotateY(180deg);
        }

        .invalid-input {
            border-color: #ef4444 !important;
            background-color: #fef2f2;
        }

        .valid-input {
            border-color: #10b981 !important;
            background-color: #f0fdf4;
        }

        body {
            min-height: max(884px, 100dvh);
        }

        /* Focus styles */
        .focus-visible:focus {
            outline: 2px solid #FFD700;
            outline-offset: 2px;
        }

        /* Loading animation */
        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        .spinner {
            animation: spin 1s linear infinite;
        }

        /* CVV tooltip */
        .cvv-tooltip {
            transform: translateX(-50%);
            z-index: 1000;
        }
    </style>
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet" />
</head>

<body class="font-display bg-gray-50 dark:bg-zinc-900">
    <div class="flex flex-col h-screen">
        <header class="bg-background-dark text-white p-4">
            <div class="container mx-auto flex items-center justify-between">
                <button class="text-white focus-visible:focus rounded-lg p-2 hover:bg-blue-900 transition-colors"
                    onclick="confirmGoBack()" aria-label="Go back to payment confirmation">
                    <span class="material-symbols-outlined">arrow_back</span>
                </button>
                <h1 class="text-lg font-bold">Card Details</h1>
                <div class="w-8"></div>
            </div>
        </header>

        <main
            class="flex-grow p-4 bg-gray-50 dark:bg-zinc-900 text-background-dark dark:text-background-light overflow-y-auto">
            <!-- Payment Amount -->
            <div class="bg-white dark:bg-zinc-800 rounded-xl p-4 mb-6 text-center shadow-sm">
                <p class="text-sm text-gray-600 dark:text-gray-400">Amount to Pay</p>
                <p class="text-2xl font-bold text-green-600" id="payment-amount">â‚¹0</p>
            </div>

            <!-- Card Preview -->
            <div class="mb-6">
                <div class="card-preview relative w-full h-48 rounded-xl p-6 text-white shadow-xl mx-auto max-w-sm"
                    id="card-preview">
                    <!-- Card Front -->
                    <div class="card-front">
                        <div class="flex justify-between items-start mb-8">
                            <div class="text-2xl font-bold">ðŸ’³</div>
                            <div class="text-right">
                                <div class="text-xs opacity-80">DEBIT CARD</div>
                                <div class="text-lg font-bold" id="card-type">VISA</div>
                            </div>
                        </div>

                        <div class="mb-6">
                            <div class="text-lg font-mono tracking-wider" id="card-number-display">
                                â€¢â€¢â€¢â€¢ â€¢â€¢â€¢â€¢ â€¢â€¢â€¢â€¢ â€¢â€¢â€¢â€¢
                            </div>
                        </div>

                        <div class="flex justify-between items-end">
                            <div>
                                <div class="text-xs opacity-80">CARDHOLDER NAME</div>
                                <div class="text-sm font-medium" id="cardholder-display">YOUR NAME</div>
                            </div>
                            <div>
                                <div class="text-xs opacity-80">EXPIRES</div>
                                <div class="text-sm font-medium" id="expiry-display">MM/YY</div>
                            </div>
                        </div>
                    </div>

                    <!-- Card Back -->
                    <div class="card-back">
                        <div class="w-full h-8 bg-black mt-4 mb-6"></div>
                        <div class="text-right mb-4">
                            <div class="text-xs opacity-80 mb-1">CVV</div>
                            <div class="bg-white text-black px-2 py-1 rounded text-sm font-mono w-16 ml-auto"
                                id="cvv-display">â€¢â€¢â€¢</div>
                        </div>
                        <div class="text-xs opacity-80 mt-8">
                            This card is property of the bank. If found, please return to the nearest branch.
                        </div>
                    </div>
                </div>
            </div>

            <!-- Card Details Form -->
            <div class="bg-white dark:bg-zinc-800 rounded-xl p-6 shadow-sm">
                <h3 class="font-bold text-lg mb-6">Enter Card Details</h3>

                <form id="card-form" class="space-y-4" novalidate>
                    <!-- Card Number -->
                    <div>
                        <label for="card-number"
                            class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                            Card Number *
                        </label>
                        <div class="relative">
                            <input type="text" id="card-number" name="cardNumber" placeholder="1234 5678 9012 3456"
                                maxlength="19" inputmode="numeric" autocomplete="cc-number"
                                aria-describedby="card-number-help card-number-error" required
                                class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent outline-none bg-white dark:bg-zinc-700 text-gray-900 dark:text-white focus-visible:focus">
                            <div class="absolute right-3 top-1/2 transform -translate-y-1/2">
                                <span class="material-symbols-outlined text-gray-400" id="card-brand-icon"
                                    aria-hidden="true">credit_card</span>
                            </div>
                        </div>
                        <div id="card-number-help" class="text-xs text-gray-500 mt-1">Enter your 16-digit card number
                        </div>
                        <div class="text-red-500 text-sm mt-1 hidden" id="card-number-error" role="alert">Please enter a
                            valid card number</div>
                    </div>

                    <!-- Expiry and CVV Row -->
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label for="expiry-date"
                                class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                Expiry Date *
                            </label>
                            <input type="text" id="expiry-date" name="expiryDate" placeholder="MM/YY" maxlength="5"
                                inputmode="numeric" autocomplete="cc-exp" aria-describedby="expiry-help expiry-error"
                                required
                                class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent outline-none bg-white dark:bg-zinc-700 text-gray-900 dark:text-white focus-visible:focus">
                            <div id="expiry-help" class="text-xs text-gray-500 mt-1">MM/YY format</div>
                            <div class="text-red-500 text-sm mt-1 hidden" id="expiry-error" role="alert">Invalid expiry
                                date</div>
                        </div>

                        <div class="relative">
                            <label for="cvv" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                CVV *
                                <button type="button" onclick="showCvvHelp()" aria-label="What is CVV? Click for help"
                                    class="ml-2 text-blue-600 hover:text-blue-700 focus-visible:focus rounded">
                                    <span class="material-symbols-outlined text-sm">help</span>
                                </button>
                            </label>
                            <input type="text" id="cvv" name="cvv" placeholder="123" maxlength="4" inputmode="numeric"
                                autocomplete="cc-csc" aria-describedby="cvv-help cvv-error" required
                                class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent outline-none bg-white dark:bg-zinc-700 text-gray-900 dark:text-white focus-visible:focus"
                                onfocus="flipCard(true)" onblur="flipCard(false)">
                            <div id="cvv-help" class="text-xs text-gray-500 mt-1">3-4 digits on back of card</div>
                            <div class="text-red-500 text-sm mt-1 hidden" id="cvv-error" role="alert">Invalid CVV</div>

                            <!-- CVV Help Tooltip -->
                            <div id="cvv-tooltip"
                                class="absolute left-1/2 bottom-full mb-2 cvv-tooltip hidden bg-black text-white text-xs p-2 rounded shadow-lg w-48">
                                <div class="text-center">
                                    <p class="mb-2">CVV is the 3-4 digit security code</p>
                                    <p class="text-xs">â€¢ Visa/MC: 3 digits on back</p>
                                    <p class="text-xs">â€¢ AMEX: 4 digits on front</p>
                                </div>
                                <div
                                    class="absolute top-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-l-4 border-r-4 border-t-4 border-transparent border-t-black">
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Cardholder Name -->
                    <div>
                        <label for="cardholder-name"
                            class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                            Cardholder Name *
                        </label>
                        <input type="text" id="cardholder-name" name="cardholderName" placeholder="John Doe"
                            autocomplete="cc-name" aria-describedby="name-help name-error" required
                            class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent outline-none bg-white dark:bg-zinc-700 text-gray-900 dark:text-white focus-visible:focus">
                        <div id="name-help" class="text-xs text-gray-500 mt-1">Enter name as printed on card</div>
                        <div class="text-red-500 text-sm mt-1 hidden" id="name-error" role="alert">Please enter
                            cardholder name</div>
                    </div>

                    <!-- Save Card Option -->
                    <div class="flex items-start">
                        <input type="checkbox" id="save-card" aria-describedby="save-card-notice"
                            class="rounded border-gray-300 text-primary focus:ring-primary mt-1 focus-visible:focus">
                        <div class="ml-3">
                            <label for="save-card" class="text-sm text-gray-700 dark:text-gray-300">
                                Save this card for future payments
                            </label>
                            <p id="save-card-notice" class="text-xs text-gray-500 mt-1">Your card will be saved securely
                                with encryption</p>
                        </div>
                    </div>
                </form>
            </div>

            <!-- Security Notice -->
            <div
                class="bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-lg p-4 mt-6">
                <div class="flex items-start">
                    <span class="material-symbols-outlined text-green-600 mr-3 mt-0.5"
                        aria-hidden="true">security</span>
                    <div>
                        <p class="text-sm text-green-800 dark:text-green-200 font-medium">100% Secure Payment</p>
                        <p class="text-xs text-green-600 dark:text-green-300 mt-1">
                            Your card details are encrypted with 256-bit SSL security. We never store your complete card
                            information.
                        </p>
                    </div>
                </div>
            </div>
        </main>

        <footer class="p-4 bg-gray-50 dark:bg-zinc-900">
            <button onclick="processPayment()" id="pay-button" disabled aria-describedby="payment-status"
                class="w-full bg-gray-400 text-white font-bold py-4 rounded-lg text-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed focus-visible:focus transform hover:scale-[1.02] active:scale-[0.98] enabled:bg-primary enabled:hover:bg-yellow-500">
                <span class="inline-flex items-center justify-center">
                    <span id="pay-text">Enter Card Details</span>
                    <span id="pay-spinner" class="ml-2 spinner hidden">
                        <span class="material-symbols-outlined">refresh</span>
                    </span>
                </span>
            </button>
            <div id="payment-status" class="sr-only" aria-live="polite"></div>
        </footer>
        Enter Card Details
        </button>
        </footer>
    </div>

    <script>
        let isCardFlipped = false;
        let isProcessing = false;
        let cvvHelpVisible = false;

        // Get payment details from URL
        function getPaymentDetails() {
            const urlParams = new URLSearchParams(window.location.search);
            const amount = urlParams.get('amount') || '0';
            const method = urlParams.get('method') || 'card';
            return { amount, method };
        }

        // Format currency
        function formatCurrency(amount) {
            return new Intl.NumberFormat('en-IN').format(amount);
        }

        // Display payment amount
        function displayPaymentAmount() {
            const { amount } = getPaymentDetails();
            document.getElementById('payment-amount').textContent = `â‚¹${formatCurrency(amount)}`;
        }

        // Format card number with spaces
        function formatCardNumber(value) {
            const v = value.replace(/\s+/g, '').replace(/[^0-9]/gi, '');
            const matches = v.match(/\d{4,16}/g);
            const match = matches && matches[0] || '';
            const parts = [];
            for (let i = 0, len = match.length; i < len; i += 4) {
                parts.push(match.substring(i, i + 4));
            }
            if (parts.length) {
                return parts.join(' ');
            } else {
                return v;
            }
        }

        // Format expiry date
        function formatExpiryDate(value) {
            const v = value.replace(/\s+/g, '').replace(/[^0-9]/gi, '');
            if (v.length >= 2) {
                return v.substring(0, 2) + (v.length > 2 ? '/' + v.substring(2, 4) : '');
            }
            return v;
        }

        // Validate card number using Luhn algorithm
        function validateCardNumber(number) {
            const digits = number.replace(/\s/g, '');
            if (digits.length < 13 || digits.length > 19 || !/^\d+$/.test(digits)) return false;

            let sum = 0;
            let isEven = false;

            for (let i = digits.length - 1; i >= 0; i--) {
                let digit = parseInt(digits[i]);

                if (isEven) {
                    digit *= 2;
                    if (digit > 9) digit -= 9;
                }

                sum += digit;
                isEven = !isEven;
            }

            return sum % 10 === 0;
        }

        // Get card type from number
        function getCardType(number) {
            const digits = number.replace(/\s/g, '');
            if (digits.match(/^4/)) return { type: 'VISA', icon: 'credit_card', color: '#1a73e8' };
            if (digits.match(/^5[1-5]/) || digits.match(/^2[2-7]/)) return { type: 'MASTERCARD', icon: 'credit_card', color: '#eb001b' };
            if (digits.match(/^3[47]/)) return { type: 'AMEX', icon: 'credit_card', color: '#00aeef' };
            if (digits.match(/^6/)) return { type: 'DISCOVER', icon: 'credit_card', color: '#ff6000' };
            return { type: 'CARD', icon: 'credit_card', color: '#666' };
        }

        // Validate expiry date
        function validateExpiryDate(expiry) {
            if (!/^\d{2}\/\d{2}$/.test(expiry)) return false;

            const [month, year] = expiry.split('/');
            const monthNum = parseInt(month);
            const yearNum = parseInt('20' + year);
            const currentDate = new Date();
            const currentYear = currentDate.getFullYear();
            const currentMonth = currentDate.getMonth() + 1;

            if (monthNum < 1 || monthNum > 12) return false;
            if (yearNum < currentYear) return false;
            if (yearNum === currentYear && monthNum < currentMonth) return false;

            return true;
        }

        // Validate CVV
        function validateCVV(cvv, cardType) {
            const length = cardType === 'AMEX' ? 4 : 3;
            return cvv.length === length && /^\d+$/.test(cvv);
        }

        // Validate cardholder name
        function validateCardholderName(name) {
            return name.trim().length >= 2 && /^[a-zA-Z\s]+$/.test(name.trim());
        }

        // Show CVV help tooltip
        function showCvvHelp() {
            const tooltip = document.getElementById('cvv-tooltip');
            cvvHelpVisible = !cvvHelpVisible;

            if (cvvHelpVisible) {
                tooltip.classList.remove('hidden');
                flipCard(true);
                announceToScreenReader('CVV help tooltip opened. CVV is a 3-4 digit security code on your card.');
            } else {
                tooltip.classList.add('hidden');
                flipCard(false);
            }
        }

        // Flip card animation
        function flipCard(showBack = null) {
            const card = document.getElementById('card-preview');
            if (showBack !== null) {
                isCardFlipped = showBack;
            } else {
                isCardFlipped = !isCardFlipped;
            }

            if (isCardFlipped) {
                card.classList.add('flipped');
            } else {
                card.classList.remove('flipped');
            }
        }

        // Update card preview
        function updateCardPreview() {
            const cardNumber = document.getElementById('card-number').value;
            const expiryDate = document.getElementById('expiry-date').value;
            const cvv = document.getElementById('cvv').value;
            const cardholderName = document.getElementById('cardholder-name').value;

            // Update card number display
            const displayNumber = cardNumber || 'â€¢â€¢â€¢â€¢ â€¢â€¢â€¢â€¢ â€¢â€¢â€¢â€¢ â€¢â€¢â€¢â€¢';
            document.getElementById('card-number-display').textContent = displayNumber;

            // Update card type and icon
            const cardInfo = getCardType(cardNumber);
            document.getElementById('card-type').textContent = cardInfo.type;
            document.getElementById('card-brand-icon').textContent = cardInfo.icon;

            // Update expiry
            document.getElementById('expiry-display').textContent = expiryDate || 'MM/YY';

            // Update cardholder name
            const displayName = cardholderName.toUpperCase() || 'YOUR NAME';
            document.getElementById('cardholder-display').textContent = displayName;

            // Update CVV
            document.getElementById('cvv-display').textContent = cvv ? 'â€¢'.repeat(cvv.length) : 'â€¢â€¢â€¢';
        }

        // Real-time field validation
        function validateField(fieldId, value) {
            const errorElement = document.getElementById(fieldId + '-error');
            let isValid = false;

            switch (fieldId) {
                case 'card-number':
                    isValid = validateCardNumber(value);
                    break;
                case 'expiry-date':
                    isValid = validateExpiryDate(value);
                    break;
                case 'cvv':
                    const cardInfo = getCardType(document.getElementById('card-number').value);
                    isValid = validateCVV(value, cardInfo.type);
                    break;
                case 'cardholder-name':
                    isValid = validateCardholderName(value);
                    break;
            }

            updateInputValidation(fieldId, isValid, value.length > 0);
            return isValid;
        }

        // Validate entire form and update button
        function validateForm() {
            const cardNumber = document.getElementById('card-number').value;
            const expiryDate = document.getElementById('expiry-date').value;
            const cvv = document.getElementById('cvv').value;
            const cardholderName = document.getElementById('cardholder-name').value;
            const payButton = document.getElementById('pay-button');
            const payText = document.getElementById('pay-text');

            const isCardValid = validateCardNumber(cardNumber);
            const isExpiryValid = validateExpiryDate(expiryDate);
            const cardInfo = getCardType(cardNumber);
            const isCvvValid = validateCVV(cvv, cardInfo.type);
            const isNameValid = validateCardholderName(cardholderName);

            const allValid = isCardValid && isExpiryValid && isCvvValid && isNameValid;

            if (allValid) {
                payButton.disabled = false;
                payButton.classList.remove('bg-gray-400');
                payButton.classList.add('bg-primary', 'hover:bg-yellow-500');
                payText.textContent = `Pay â‚¹${formatCurrency(getPaymentDetails().amount)}`;
            } else {
                payButton.disabled = true;
                payButton.classList.add('bg-gray-400');
                payButton.classList.remove('bg-primary', 'hover:bg-yellow-500');
                payText.textContent = 'Enter Card Details';
            }
        }

        // Update input validation styling
        function updateInputValidation(inputId, isValid, hasValue) {
            const input = document.getElementById(inputId);
            const errorElement = document.getElementById(inputId + '-error');

            if (hasValue) {
                if (isValid) {
                    input.classList.remove('invalid-input');
                    input.classList.add('valid-input');
                    if (errorElement) errorElement.classList.add('hidden');
                } else {
                    input.classList.remove('valid-input');
                    input.classList.add('invalid-input');
                    if (errorElement) errorElement.classList.remove('hidden');
                }
            } else {
                input.classList.remove('valid-input', 'invalid-input');
                if (errorElement) errorElement.classList.add('hidden');
            }
        }

        function confirmGoBack() {
            if (confirm('Are you sure you want to go back? Your card details will be lost.')) {
                window.history.back();
            }
        }

        // Process payment
        function processPayment() {
            if (isProcessing) return;

            const { amount, method } = getPaymentDetails();
            const form = document.getElementById('card-form');

            // Final validation
            if (!form.checkValidity()) {
                form.reportValidity();
                return;
            }

            isProcessing = true;
            showLoadingState();

            // Announce to screen readers
            announceToScreenReader('Processing your card payment, please wait');

            // Simulate payment processing
            setTimeout(() => {
                window.location.href = `payment_processing.html?amount=${amount}&method=${method}`;
            }, 2000);
        }

        function showLoadingState() {
            const payButton = document.getElementById('pay-button');
            const payText = document.getElementById('pay-text');
            const paySpinner = document.getElementById('pay-spinner');

            payText.textContent = 'Processing...';
            paySpinner.classList.remove('hidden');
            payButton.disabled = true;
        }

        function announceToScreenReader(message) {
            const statusDiv = document.getElementById('payment-status');
            statusDiv.textContent = message;
        }

        // Add event listeners
        document.addEventListener('DOMContentLoaded', function () {
            displayPaymentAmount();

            // Card number formatting and validation
            document.getElementById('card-number').addEventListener('input', function (e) {
                const originalValue = e.target.value;
                e.target.value = formatCardNumber(originalValue);
                validateField('card-number', e.target.value);
                updateCardPreview();
                validateForm();
            });

            document.getElementById('card-number').addEventListener('blur', function (e) {
                validateField('card-number', e.target.value);
            });

            // Expiry date formatting
            document.getElementById('expiry-date').addEventListener('input', function (e) {
                const originalValue = e.target.value;
                e.target.value = formatExpiryDate(originalValue);
                validateField('expiry-date', e.target.value);
                updateCardPreview();
                validateForm();
            });

            document.getElementById('expiry-date').addEventListener('blur', function (e) {
                validateField('expiry-date', e.target.value);
            });

            // CVV validation
            document.getElementById('cvv').addEventListener('input', function (e) {
                e.target.value = e.target.value.replace(/\D/g, '').substring(0, 4);
                validateField('cvv', e.target.value);
                updateCardPreview();
                validateForm();
            });

            document.getElementById('cvv').addEventListener('blur', function (e) {
                validateField('cvv', e.target.value);
                // Hide CVV tooltip when focus leaves
                if (cvvHelpVisible) {
                    showCvvHelp();
                }
            });

            // Cardholder name
            document.getElementById('cardholder-name').addEventListener('input', function (e) {
                // Allow only letters and spaces
                e.target.value = e.target.value.replace(/[^a-zA-Z\s]/g, '');
                validateField('cardholder-name', e.target.value);
                updateCardPreview();
                validateForm();
            });

            document.getElementById('cardholder-name').addEventListener('blur', function (e) {
                validateField('cardholder-name', e.target.value);
            });

            // Hide CVV tooltip when clicking outside
            document.addEventListener('click', function (e) {
                if (cvvHelpVisible && !e.target.closest('#cvv') && !e.target.closest('button[onclick="showCvvHelp()"]')) {
                    showCvvHelp();
                }
            });

            // Prevent form submission on Enter
            document.getElementById('card-form').addEventListener('submit', function (e) {
                e.preventDefault();
                if (!document.getElementById('pay-button').disabled) {
                    processPayment();
                }
            });
        });
    </script>
</body>

</html>